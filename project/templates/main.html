<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--google icon fonts-->
    <link
      href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp"
      rel="stylesheet"
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      type="text/css"
      media="screen"
      href="{% static 'css/main.css' %}"
    />

    <title>Hello, world!</title>
  </head>
  <body>
    <!-- nav -->
    <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid nav-flex">
        <div>
          <a class="navbar-brand" href="#"
            ><img
              src="https://www.instagram.com/static/images/web/mobile_nav_type_logo-2x.png/1b47f9d0e595.png"
              alt=""
              width="100"
              class="d-inline-block align-text-top"
          /></a>
        </div>
        <div>
          <input
            class="form-control me-2"
            type="search"
            placeholder="Search"
            aria-label="Search"
          />
        </div>
        <div>
          <i class="material-icons">home</i>
          <i class="material-icons-outlined">send</i>
          <i class="material-icons-outlined" id="add_feed">add_box</i>
          <i class="material-icons-outlined">explore</i>
          <i class="material-icons-outlined">favorite_border</i>
        </div>
      </div>
    </nav>
    <div class="flex-wrap mt-5">
      <div class="item bg-light">
        {% for feed in feeds %}
        <div class="item-box">
          <div class="flex-center p-2">
            <img class="img-circle" src="{{feed.profile_image}}" alt="" /><span
              class="user-name ps-2"
              >{{feed.user_id}}</span
            >
          </div>
          <div class="text-center p-0 m-0">
            <img class="img-auto-size" src="{{feed.image}}" alt="" />
          </div>
          <div class="icon-box m-2">
            <div>
              <i class="material-icons-outlined">favorite_border</i>
              <i class="material-icons-outlined">question_answer</i>
              <i class="material-icons-outlined">send</i>
            </div>
            <div>
              <i class="material-icons-outlined">bookmark_border</i>
            </div>
          </div>
          <div class="font-6">좋아요 {{feed.like_count}}개</div>
          <div>{{feed.content | linebreaksbr}}</div>
          <div class="pt-3">댓글들</div>
          <hr />
          <div>
            <div class="input-group flex-nowrap">
              <span class="input-group-text" id="addon-wrapping"
                ><i class="material-icons-outlined"
                  >sentiment_satisfied</i
                ></span
              >
              <input
                type="text"
                class="form-control"
                placeholder="댓글 달기..."
                aria-label="Username"
                aria-describedby="addon-wrapping"
              />
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      <hr />
      <div class="item">
        <div class="left-box">
          <div class="p-2 flex-center">
            <div>
              <img
                class="img-circle"
                src="https://pbs.twimg.com/profile_images/1374979417915547648/vKspl9Et_400x400.jpg"
                alt=""
              />
            </div>
            <div class="align-left ps-2">
              <span class="user-name">작성자</span>
              <p>yellow0721</p>
            </div>
          </div>
          <div>
            회원님을 위한 추천
            <a href=""><span class="font-6">보두보기</span></a>
          </div>
          <div class="p-2 flex-center">
            <div>
              <img
                class="img-circle"
                src="https://encrypted-tbn2.gstatic.com/images?q=tbn:ANd9GcRbYmZXA9UcB07Kxq9iqkALykQzYQZvBfd5r33ZcYuyiDqjn1Gv"
                alt=""
              />
            </div>
            <div class="align-left ps-2">
              <span class="user-name">작성자</span>
              <p>yellow0721</p>
            </div>
            <div><a href="" class="font-6">팔로우</a></div>
          </div>
          <div class="p-2 flex-center">
            <div>
              <img
                class="img-circle"
                src="http://www.sisamagazine.co.kr/news/photo/202202/429551_432767_1755.jpg"
                alt=""
              />
            </div>
            <div class="align-left ps-2">
              <span class="user-name">작성자</span>
              <p>yellow0721</p>
            </div>
            <div><a href="" class="font-6">팔로우</a></div>
          </div>
          <div class="p-2 flex-center">
            <div>
              <img
                class="circular_image"
                src="https://img.tvreportcdn.de/cms-content/uploads/2021/08/28/13d966d2-f7a0-4804-9b7a-7ac36758084e.jpg"
                alt=""
              />
            </div>
            <div class="align-left ps-2">
              <span class="user-name">작성자</span>
              <p>yellow0721</p>
            </div>
            <div><a href="" class="font-6">팔로우</a></div>
          </div>
          <div class="font-6 mt-2">
            소개도움말홍보 센터API채용 정보개인정보처리방침약관위치인기
            계정해시태그언어
          </div>
          <div class="font-6 mt-1">© 2022 INSTAGRAM FROM META</div>
        </div>
      </div>
    </div>
    <!-- modal! 111-->
    <div id="modal_add_feed" class="modal_overlay">
      <div class="modal_window">
        <div class="modal_flex">
          <div></div>
          <div>이미지업로드</div>
          <div><i class="material-icons-outlined">close</i></div>
        </div>
        <div class="upload-space mt-2">
          <p>drag and drop your image!</p>
          <div class="content"></div>
        </div>
      </div>
    </div>
    <!-- modal! 222-->
    <div id="modal_add_feed2" class="modal_overlay2">
      <div class="modal_window">
        <div class="modal_flex">
          <div></div>
          <div>두번째 모달</div>
          <div><i class="material-icons-outlined">close</i></div>
        </div>
        <div class="upload-space2 mt-2">
          <div id="uploaded-image" class="content-text"></div>
          <div class="content-text m-2">
            <div>글 작성하기</div>
            <div class="p-2">
              <textarea
                class="form-control"
                id="feed-create-conent"
                rows="3"
              ></textarea>
            </div>
            <div class="p-2">
              <button
                id="feed-create-button"
                type="button"
                class="btn btn-primary btn-lg btn-block"
              >
                공유하기
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript; choose one of the two! -->
    <!-- 제이쿼리 cdn -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Option 1: Bootstrap Bundle with Popper -->

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->

    <script>
      let files;

      const modal = document.getElementById("modal_add_feed");
      const body = document.body;

      document
        .getElementById("add_feed")
        .addEventListener("click", function () {
          modal.style.display = "flex";
          body.style.overflow = "hidden";
        });
      document
        .getElementById("feed-create-button")
        .addEventListener("click", function () {
          alert("tttt" + files[0].name);
          let file = files;
          let image = files[0].name;
          let content = $("#feed-create-conent").val();
          let user_id = "yellow0721";
          let profile_image =
            "https://pbs.twimg.com/profile_images/1374979417915547648/vKspl9Et_400x400.jpg";

          let fd = new FormData();

          fd.append("file", file);
          fd.append("image", image);
          fd.append("content", content);
          fd.append("user_id", user_id);
          fd.append("profile_image", profile_image);

          $.ajax({
            url: "/content/upload",
            data: fd,
            mothod: "POST",
            contentType: false,
            processData: false,

            success: function (data) {
              console.log("good");
            },
            error: function (request, status, error) {
              console.log("bad");
            },
            complite: function () {
              console.log("finish");
            },
          });
        });

      $(".upload-space")
        .on("dragover", dragOver)
        .on("dragleave", dragOver)
        .on("drop", uploadFiles);

      function dragOver(e) {
        e.stopPropagation();
        e.preventDefault();
        if (e.type == "dragover") {
          $(e.target).css({
            "background-color": "black",
            "outline-offset": "-20px",
          });
        } else {
          $(e.target).css({
            "background-color": "gray",
            "outline-offset": "-10px",
          });
        }
      }

      function uploadFiles(e) {
        e.stopPropagation();
        e.preventDefault();
        dragOver(e);

        e.dataTransfer = e.originalEvent.dataTransfer;
        files = e.target.files || e.dataTransfer.files;
        if (files.length > 1) {
          alert("하나만 올려라.");
          return;
        }
        if (files[0].type.match(/image.*/)) {
          $("#modal_add_feed").css({
            display: "none",
          });
          $("#modal_add_feed2").css({
            display: "flex",
          });
          $("#uploaded-image").css({
            "background-image":
              "url(" + window.URL.createObjectURL(files[0]) + ")",
            outline: "none",
            width: "60%",
            "padding-top": "55%",
            "background-size": "100% 100%",
          });
          /*
          $(e.target).css({
            "background-image":
              "url(" + window.URL.createObjectURL(files[0]) + ")",
            outline: "none",
            "background-size": "100% 100%",
          });
          */
        } else {
          alert("이미지가 아닙니다.");
          return;
        }
      }
    </script>
  </body>
</html>
